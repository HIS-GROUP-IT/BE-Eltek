{"version":3,"sources":["../../src/middlewares/authorizationMiddleware.ts"],"sourcesContent":["import { SECRET_KEY } from \"@/config\";\r\nimport { HttpException } from \"@/exceptions/HttpException\";\r\nimport { DataStoreInToken, RequestWithUser } from \"@/types/auth.types\";\r\nimport { NextFunction, Response } from \"express\";\r\nimport { verify, VerifyErrors } from \"jsonwebtoken\";\r\n\r\nexport const authorizationMiddleware = (req:RequestWithUser,res:Response,next:NextFunction) => {\r\n    const authHeader = req.headers[\"authorization\"];\r\n    const token = authHeader && authHeader.split(\" \")[1];\r\n    if(!token){\r\n       throw new HttpException(401,\"Authentication required\");        \r\n    }\r\n    verify(token,SECRET_KEY,(error:VerifyErrors, user:DataStoreInToken) =>{\r\n        if(error){\r\n           throw new HttpException(401,error.message)\r\n        }\r\n        req.user = user ;\r\n        next();\r\n    });\r\n}\r\n\r\n\r\n\r\nexport const SuperAdminAuthorizationMiddleware = (req:RequestWithUser,res:Response,next:NextFunction) => {\r\n    const authHeader = req.headers[\"authorization\"];\r\n    const token = authHeader && authHeader.split(\" \")[1];\r\n    if(!token){\r\n       throw new HttpException(401,\"Authentication required\");        \r\n    }\r\n    verify(token,SECRET_KEY,(error:VerifyErrors, user:DataStoreInToken) =>{\r\n        if(error){\r\n           throw new HttpException(401,error.message)\r\n        }        \r\n        if(user.role !== \"SuperAdmin\"){\r\n            throw new HttpException(401,\"Super admin rights required!\");\r\n        }\r\n     \r\n        req.user = user ;\r\n        next();\r\n    });\r\n}\r\n"],"names":["SuperAdminAuthorizationMiddleware","authorizationMiddleware","req","res","next","authHeader","headers","token","split","HttpException","verify","SECRET_KEY","error","user","message","role"],"mappings":";;;;;;;;;;;IAuBaA,iCAAiC;eAAjCA;;IAjBAC,uBAAuB;eAAvBA;;;wBANc;+BACG;8BAGO;AAE9B,MAAMA,0BAA0B,CAACC,KAAoBC,KAAaC;IACrE,MAAMC,aAAaH,IAAII,OAAO,CAAC,gBAAgB;IAC/C,MAAMC,QAAQF,cAAcA,WAAWG,KAAK,CAAC,IAAI,CAAC,EAAE;IACpD,IAAG,CAACD,OAAM;QACP,MAAM,IAAIE,4BAAa,CAAC,KAAI;IAC/B;IACAC,IAAAA,oBAAM,EAACH,OAAMI,kBAAU,EAAC,CAACC,OAAoBC;QACzC,IAAGD,OAAM;YACN,MAAM,IAAIH,4BAAa,CAAC,KAAIG,MAAME,OAAO;QAC5C;QACAZ,IAAIW,IAAI,GAAGA;QACXT;IACJ;AACJ;AAIO,MAAMJ,oCAAoC,CAACE,KAAoBC,KAAaC;IAC/E,MAAMC,aAAaH,IAAII,OAAO,CAAC,gBAAgB;IAC/C,MAAMC,QAAQF,cAAcA,WAAWG,KAAK,CAAC,IAAI,CAAC,EAAE;IACpD,IAAG,CAACD,OAAM;QACP,MAAM,IAAIE,4BAAa,CAAC,KAAI;IAC/B;IACAC,IAAAA,oBAAM,EAACH,OAAMI,kBAAU,EAAC,CAACC,OAAoBC;QACzC,IAAGD,OAAM;YACN,MAAM,IAAIH,4BAAa,CAAC,KAAIG,MAAME,OAAO;QAC5C;QACA,IAAGD,KAAKE,IAAI,KAAK,cAAa;YAC1B,MAAM,IAAIN,4BAAa,CAAC,KAAI;QAChC;QAEAP,IAAIW,IAAI,GAAGA;QACXT;IACJ;AACJ"}